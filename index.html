<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Obrigado pela sua avaliação!</title>
<style>
  body { font-family:"Segoe UI",Arial,sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#f4f6fa; }
  .card { background:white; padding:36px 44px; border-radius:14px; max-width:460px; text-align:center; }
  h1 { color:#004aad; font-size:1.7rem; }
  p { color:#004aad; font-size:0.95rem; }
  .feedback { text-align:left; margin-top:18px; color:#004aad; font-size:0.92rem; }
  .feedback ul { padding-left:18px; margin:0; }
  .comentario-extra { margin-top:18px; text-align:left; }
  .comentario-extra textarea { width:100%; min-height:45px; padding:6px 8px; margin-top:6px; border:1px solid #ccd6eb; border-radius:6px; }
  .comentario-extra button { margin-top:10px; width:100%; padding:9px; background:#004aad; color:white; border:none; border-radius:6px; cursor:pointer; }
  .comentario-extra button:hover { background:#00327a; }
</style>
</head>
<body>
<div class="card">
  <h1>Obrigado pela sua avaliação!</h1>
  <p>Sua opinião é essencial para aprimorarmos continuamente nossos serviços.</p>

  <div class="feedback">
    <ul>
      <li><strong>Chamado:</strong> <span id="retorno-chamado"></span></li>
      <li><strong>CSAT:</strong> <span id="retorno-nota"></span></li>
      <li><strong>Motivo:</strong> <span id="retorno-motivo"></span></li>
    </ul>
  </div>

  <div class="comentario-extra">
    <label for="comentarioExtra">Comentário adicional (opcional):</label>
    <textarea id="comentarioExtra" placeholder="Escreva seu comentário..."></textarea>
    <button id="btnEnviarComentario">Enviar comentário</button>
  </div>
</div>

<script>
(function() {
  const params = new URLSearchParams(window.location.search);
  const chamado = params.get("Chamado") || "-";
  const csat = params.get("CSAT") || "-";
  let motivo = params.get("Motivo") || "";

  // Se Motivo não veio na URL, podemos definir um valor padrão ou capturá-lo de outra forma
  if (!motivo) motivo = "Sem Motivo informado";

  const id = params.get("ID") || Date.now(); // ID único

  // Exibe no HTML
  document.getElementById("retorno-chamado").textContent = chamado;
  document.getElementById("retorno-nota").textContent = csat;
  document.getElementById("retorno-motivo").textContent = motivo;

  const urlWebApp = "https://script.google.com/macros/s/AKfycbyPDrocs97Un5qdG37ofA6SNHLQIUw1s3LMbd9FGS7iC1E5i3ma7DeStrVhClhdGjXZ/exec";

  function enviarDados(comentario) {
    const payload = new URLSearchParams({
      ID: id,
      Chamado: chamado,
      CSAT: csat,
      Motivo: motivo,
      Comentario: comentario || ""
    });

    fetch(urlWebApp, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: payload
    })
    .then(r => r.text())
    .then(data => console.log("Dados enviados:", data))
    .catch(err => console.error("Erro ao enviar dados:", err));
  }

  // Envia nota inicial com Motivo
  enviarDados("");

  // Comentário extra
  document.getElementById("btnEnviarComentario").addEventListener("click", () => {
    const comentarioExtra = document.getElementById("comentarioExtra").value.trim();
    if (!comentarioExtra) return alert("Digite algum comentário antes de enviar!");
    enviarDados(comentarioExtra);
    alert("Comentário enviado com sucesso!");
    document.getElementById("comentarioExtra").value = "";
  });
})();
</script>
</body>
</html>
