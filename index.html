<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Obrigado pela sua avaliaÃ§Ã£o!</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f4f6fa;
      color: #333;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      text-align: center;
    }
    .card {
      background: white;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      max-width: 480px;
      animation: fadeIn 1.5s ease-in-out;
    }
    h1 {
      color: #004aad;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
    p {
      font-size: 1rem;
      color: #004aad;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    .logo {
      width: 150px;
      margin-top: 10px;
    }
    .heart {
      font-size: 2rem;
      color: #004aad;
      margin-bottom: 10px;
      animation: pulse 1.8s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 0.9; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    footer {
      margin-top: 30px;
      font-size: 0.85rem;
      color: #777;
    }
    footer a {
      color: #004aad;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="heart">ðŸ’™</div>
    <h1>Obrigado pela sua avaliaÃ§Ã£o!</h1>
    <p>Sua opiniÃ£o Ã© essencial para aprimorarmos continuamente nossos serviÃ§os e oferecer a melhor experiÃªncia possÃ­vel.</p>
    <img src="logo.PNG" alt="Integral Trust ServiÃ§os" class="logo" />
    <footer>Â© 2025 <a href="https://integraltrust.com.br">Integral Trust ServiÃ§os</a></footer>
  </div>

  <script>
    (async function() {
      // Pega os parÃ¢metros da URL
      const params = new URLSearchParams(window.location.search);
      const chamado = params.get("Chamado");
      const csat = params.get("CSAT");
      const motivo = params.get("Motivo");
      const nota = params.get("Nota");

      // --- Envio para Power Automate ---
      if (chamado && csat) {
        const payload = { Chamado: chamado, CSAT: csat };
        const urlPowerAutomate = "https://default5961f5edef6943308e48ee13bc43df.5f.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/9ca104bad68340caa8cc82145178e81b/triggers/manual/paths/invoke?api-version=1";
        fetch(urlPowerAutomate, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        })
        .then(response => console.log("Power Automate enviado:", response))
        .catch(err => console.error("Erro Power Automate:", err));
      }

      // --- Envio para Microsoft Forms ---
      if (chamado || motivo || nota) {
        const formId = "7fVhWWnvMEOOSO4TvEPfXyvNSCFaLtZFueawlnwNW75UQUZIWVVDRFdMV1NGVVczVTc5NFMyRVEwSC4u";
        const formUrl = "https://forms.office.com/formResponse";
        const data = new URLSearchParams();
        data.append("id", formId);

        function findInputByTitle(title) {
          const question = Array.from(document.querySelectorAll('[data-automation-id="questionTitle"]'))
            .find(el => el.innerText.includes(title));
          if (!question) return null;
          const container = question.closest('[data-automation-id="questionContent"]');
          if (!container) return null;
          const input = container.querySelector('input[name^="entry."], textarea[name^="entry."]');
          return input ? input.getAttribute('name') : null;
        }

        const entryChamado = findInputByTitle("Chamado");
        const entryMotivo = findInputByTitle("Motivo");
        const entryNota = findInputByTitle("Nota");

        if (entryChamado && chamado) data.append(entryChamado, chamado);
        if (entryMotivo && motivo) data.append(entryMotivo, motivo);
        if (entryNota && nota) data.append(entryNota, nota);

        fetch(formUrl, {
          method: "POST",
          mode: "no-cors",
          body: data
        });
        console.log("Microsoft Forms enviado!");
      }
    })();
  </script>
</body>
</html>
