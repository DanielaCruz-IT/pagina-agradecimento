<script>
window.onload = function() {
  const urlParams = new URLSearchParams(window.location.search);
  const chamado = urlParams.get('Chamado');
  const csat = urlParams.get('CSAT');

  const messageEl = document.querySelector('.message');
  
  if (chamado && csat) {
    // Verifica se os elementos existem antes de setar o valor
    const chamadoInput = document.getElementById('Chamado');
    const csatInput = document.getElementById('CSAT');

    if (chamadoInput) chamadoInput.value = chamado;
    if (csatInput) csatInput.value = csat;

    const formData = new FormData();
    formData.append('form-name', 'csat');
    formData.append('Chamado', chamado);
    formData.append('CSAT', csat);

    fetch("/", { method: "POST", body: formData })
      .catch(err => {
        console.error("Erro ao enviar formulário:", err);
        if (messageEl) messageEl.textContent = 'Erro ao enviar formulário.';
      })
      .finally(() => {
        // Redireciona após 3 segundos
        setTimeout(() => {
          window.location.href = 'https://danielacruz-it.github.io/pagina-agradecimento/';
        }, 3000);
      });

    // Mensagem opcional enquanto redireciona
    if (messageEl) messageEl.textContent = 'Nota registrada ✔️ Redirecionando...';
    
  } else {
    if (messageEl) {
      messageEl.textContent = 'Erro: parâmetros não encontrados.';
    } else {
      console.error('Erro: parâmetros não encontrados.');
    }
  }
};
</script>
